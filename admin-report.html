<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Reports â€“ HAFEDPOLY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  *{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;margin:0;padding:0;}
  body{background:linear-gradient(135deg,#f0f2f5,#e0e5ec);color:#333;min-height:100vh;}
  header{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1);}
  header h1{color:#007bff;font-size:20px;}
  .hamburger{width:28px;height:20px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;}
  .hamburger span{height:3px;background:#007bff;border-radius:2px;display:block;transition:.3s;}
  .hamburger.active span:nth-child(1){transform:translateY(8.5px) rotate(45deg);}
  .hamburger.active span:nth-child(2){opacity:0;}
  .hamburger.active span:nth-child(3){transform:translateY(-8.5px) rotate(-45deg);}
  nav{position:fixed;top:0;right:-250px;width:220px;height:100%;background:#fff;box-shadow:-2px 0 10px rgba(0,0,0,.15);padding:20px;transition:.3s;z-index:1000;}
  nav.active{right:0;}
  nav a{display:block;margin:14px 0;color:#007bff;text-decoration:none;font-weight:600;}
  .container{max-width:1200px;margin:20px auto;padding:0 20px;}
  .cards{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:30px;}
  .card{flex:1 1 220px;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);text-align:center;transition:.3s;}
  .card:hover{transform:translateY(-3px);box-shadow:0 6px 18px rgba(0,0,0,.15);}
  .card h3{font-size:16px;color:#555;margin-bottom:10px;}
  .card p{font-size:22px;font-weight:600;color:#007bff;}
  .chartBox{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);margin-bottom:30px;}
  canvas{max-width:100%;}
</style>
</head>
<body>

<header>
  <h1>Admin Reports</h1>
  <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</header>

<nav id="nav">
  <a href="admin-dashboard.html">Dashboard</a>
  <a href="admin-complaint.html">Complaints</a>
  <a href="admin-suggestion.html">Suggestions</a>
  <a href="admin-announcement.html">Announcements</a>
  <a href="admin-verify.html">Verify IDs</a>
  <a href="admin-report.html">Reports</a>
  <a href="#" id="logoutLink">Logout</a>
</nav>

<div class="container">
  <!-- Summary Cards -->
  <div class="cards">
    <div class="card"><h3>Total Complaints</h3><p id="totalComplaints">0</p></div>
    <div class="card"><h3>Total Suggestions</h3><p id="totalSuggestions">0</p></div>
    <div class="card"><h3>Resolved Complaints</h3><p id="resolvedComplaints">0</p></div>
    <div class="card"><h3>Resolved Suggestions</h3><p id="resolvedSuggestions">0</p></div>
  </div>

  <!-- Charts -->
  <div class="chartBox"><h2>Complaints by Category</h2><canvas id="complaintChart"></canvas></div>
  <div class="chartBox"><h2>Suggestions by Category</h2><canvas id="suggestionChart"></canvas></div>
  <div class="chartBox"><h2>Complaints Status</h2><canvas id="complaintStatusChart"></canvas></div>
  <div class="chartBox"><h2>Suggestions Status</h2><canvas id="suggestionStatusChart"></canvas></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const $=id=>document.getElementById(id);
const hamburger=$("hamburger"), nav=$("nav");
hamburger.onclick=()=>{hamburger.classList.toggle("active"); nav.classList.toggle("active");};
$("logoutLink").onclick=()=>{ localStorage.removeItem("activeAdmin"); location.href="login.html"; };

// Helpers
function countByCategory(items){ const counts={}; items.forEach(i=>{ counts[i.category||"Uncategorized"]=(counts[i.category]||0)+1; }); return Object.entries(counts).sort((a,b)=>b[1]-a[1]); }
function countByStatus(items){ const counts={}; items.forEach(i=>{ counts[i.status||"Pending"]=(counts[i.status]||0)+1; }); return Object.entries(counts); }

// Render Charts
function renderBarChart(id,label,data){
  new Chart($(id).getContext("2d"),{type:"bar",data:{labels:data.map(d=>d[0]),datasets:[{label,label,data:data.map(d=>d[1]),backgroundColor:"#007bff"}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});
}
function renderDoughnutChart(id,label,data){
  new Chart($(id).getContext("2d"),{type:"doughnut",data:{labels:data.map(d=>d[0]),datasets:[{label,data:data.map(d=>d[1]),backgroundColor:["#28a745","#ffc107","#dc3545","#007bff"]}]}});
}

// Load reports
function loadReports(){
  const complaints=JSON.parse(localStorage.getItem("complaints")||"[]");
  const suggestions=JSON.parse(localStorage.getItem("suggestions")||"[]");

  $("totalComplaints").innerText=complaints.length;
  $("totalSuggestions").innerText=suggestions.length;
  $("resolvedComplaints").innerText=complaints.filter(c=>c.status==="Resolved").length;
  $("resolvedSuggestions").innerText=suggestions.filter(s=>s.status==="Resolved").length;

  renderBarChart("complaintChart","Complaints by Category",countByCategory(complaints));
  renderBarChart("suggestionChart","Suggestions by Category",countByCategory(suggestions));
  renderDoughnutChart("complaintStatusChart","Complaints Status",countByStatus(complaints));
  renderDoughnutChart("suggestionStatusChart","Suggestions Status",countByStatus(suggestions));
}

// Init
loadReports();

// Close nav if clicking outside
document.addEventListener('click', e=>{
  if(!nav.contains(e.target) && !hamburger.contains(e.target)){
    nav.classList.remove("active"); hamburger.classList.remove("active");
  }
});
</script>

</body>
</html>