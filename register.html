<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Registration – HAFEDPOLY</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
/* Base styling */
*{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;}
body{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px;
      background:#007bff;position:relative;overflow:hidden;}
#networkCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;}

/* Form box */
.box{width:100%;max-width:480px;background:#fff;border-radius:16px;padding:28px 24px;
     box-shadow:0 10px 30px rgba(0,0,0,.15);animation:fadeIn .5s ease;position:relative;z-index:1;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Heading */
h1{margin:0 0 8px;color:#007bff;font-size:24px;text-align:center;}
p.sub{margin:0 0 18px;text-align:center;color:#555;font-size:14px;}

/* Labels & Inputs */
label{display:block;margin-top:12px;font-weight:600;color:#333;}
input,select{width:100%;padding:12px;border:1px solid #ccc;border-radius:10px;margin-top:6px;
            outline:none;transition:.2s;font-size:14px;}
input:focus,select:focus{border-color:#007bff;box-shadow:0 0 0 4px rgba(0,123,255,.12);}

/* Grid */
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}

/* Password toggle */
.pass-wrap{position:relative;}
.toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);
        font-size:12px;color:#007bff;cursor:pointer;user-select:none;}

/* Buttons */
button{width:100%;padding:12px;border:none;border-radius:10px;
       background:#007bff;color:#fff;font-weight:700;margin-top:16px;cursor:pointer;font-size:14px;}
button:hover{background:#005ecb;}

/* Messages */
.msg{margin-top:12px;text-align:center;font-weight:600;font-size:14px;}
.err{color:#d60000;}
.ok{color:#188038;}

/* Small text */
.small{margin-top:14px;text-align:center;font-size:13px;}
.small a{color:#007bff;text-decoration:none;}
.small a:hover{text-decoration:underline;}

/* Unique ID */
#uniqueBox{display:none;margin-top:14px;text-align:center;font-size:14px;font-weight:600;color:#333;}
#uniqueBox span{color:#188038;}
</style>
</head>
<body>
<canvas id="networkCanvas"></canvas>

<div class="box">
  <h1>Student Registration</h1>
  <p class="sub">HAFEDPOLY Portal</p>

  <form id="form">
    <label>Full Name</label>
    <input id="name" placeholder="e.g. Aisha Bello" required />

    <label>Email</label>
    <input id="email" type="email" placeholder="e.g. aisha@mail.com" required />

    <label>Reg No</label>
    <input id="regno" placeholder="e.g. NDCS/22/034" required />

    <div class="row">
      <div>
        <label>Level</label>
        <select id="level" required>
          <option value="">-- Select Level --</option>
          <option>ND1</option><option>ND2</option>
          <option>HND1</option><option>HND2</option>
        </select>
      </div>
      <div>
        <label>Department (auto)</label>
        <input id="dept" placeholder="Auto from Reg No" readonly />
      </div>
    </div>

    <label>Password</label>
    <div class="pass-wrap">
      <input id="password" type="password" placeholder="Min 6 characters" required />
      <span class="toggle" id="togglePass"><i class="fa-solid fa-eye"></i></span>
    </div>

    <button type="submit">Create Account</button>
  </form>

  <div id="msg" class="msg"></div>

  <!-- Hidden Unique ID box -->
  <div id="uniqueBox">Your Unique ID: <span id="suid">N/A</span></div>

  <div class="small">Already have an account? <a href="login.html">Login</a></div>
</div>

<script>
// Department mapping
const DEPARTMENTS = {
  CS:"Computer Science", SLT:"Science Laboratory Technology", BAM:"Business Administration",
  ACC:"Accountancy", BF:"Banking & Finance", MASS:"Mass Communication", EE:"Electrical Engineering",
  CENG:"Computer Engineering", CE:"Civil Engineering", ME:"Mechanical Engineering",
  MEC:"Mechatronics", ARCH:"Architectural Technology", STAT:"Mathematics & Statistics",
  PAD:"Public Administration", LIS:"Library Science", QS:"Quantity Surveying", EM:"Estate Management",
  BT:"Building Technology", URP:"Urban & Regional Planning", PT:"Polymer Technology", 
  FT:"Fishery Technology", AGT:"Agricultural Technology", HM:"Hospitality Management", 
  FDCT:"Fashion Design"
};
const REGEX = /^(ND|HND)([A-Z]{2,5})\/(\d{2})\/(0\d{2})$/;
const $ = id => document.getElementById(id);
const msg = $("msg");

// Password toggle
$("togglePass").onclick = () => {
  const f = $("password");
  f.type = f.type === "password" ? "text" : "password";
  $("togglePass").innerHTML = f.type === "password" ? '<i class="fa-solid fa-eye"></i>' : '<i class="fa-solid fa-eye-slash"></i>';
};

// Auto department detection
$("regno").addEventListener("input", () => {
  const reg = $("regno").value.toUpperCase().trim();
  const m = reg.match(/^(ND|HND)([A-Z]{2,5})\//);
  $("dept").value = m ? (DEPARTMENTS[m[2]] || "") : "";
});

// Unique ID generator
function genUniqueId(){ 
  return ("HAF-" + Date.now().toString(36) + "-" + Math.random().toString(36).slice(2,6)).toUpperCase(); 
}

// Submit form
$("form").addEventListener("submit", e => {
  e.preventDefault(); msg.textContent = ""; msg.className="msg";

  const name = $("name").value.trim();
  const email = $("email").value.trim();
  const regno = $("regno").value.toUpperCase().trim();
  const level = $("level").value;
  const password = $("password").value.trim();

  if(password.length<6){msg.textContent="Password must be at least 6 characters."; msg.classList.add("err"); return;}
  if(!REGEX.test(regno)){msg.textContent="Invalid Reg No! Example: NDCS/22/034"; msg.classList.add("err"); return;}
  const deptCode = regno.match(REGEX)[2];
  const department = DEPARTMENTS[deptCode];
  if(!department){msg.textContent="Department code not recognized in Reg No."; msg.classList.add("err"); return;}

  let users = JSON.parse(localStorage.getItem("users") || "[]");
  if(users.some(u => u.regno===regno)){msg.textContent="Reg No already registered."; msg.classList.add("err"); return;}
  if(users.some(u => u.email===email)){msg.textContent="Email already registered."; msg.classList.add("err"); return;}

  // ✅ use uniqueId consistently
  const user = {uniqueId:genUniqueId(), name, email, regno, level, department, password, role:"student", pic:""};
  users.push(user);
  localStorage.setItem("users", JSON.stringify(users));

  msg.textContent = "Registered successfully!"; msg.classList.add("ok");
  $("suid").textContent = user.uniqueId; 
  $("uniqueBox").style.display = "block"; // reveal unique ID box

  localStorage.setItem("activeUser", JSON.stringify(user));
  setTimeout(()=>location.href="login.html",1500);
});

// Network particle background
const canvas = document.getElementById('networkCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let nodes = [];
const nodeCount = 100;
const maxDist = 120;
for(let i=0;i<nodeCount;i++){
  nodes.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    vx:(Math.random()-0.5)*0.7,
    vy:(Math.random()-0.5)*0.7,
    r:Math.random()*3+1
  });
}
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  nodes.forEach(n=>{
    n.x+=n.vx; n.y+=n.vy;
    if(n.x<0||n.x>canvas.width) n.vx*=-1;
    if(n.y<0||n.y>canvas.height) n.vy*=-1;
    ctx.beginPath();
    ctx.arc(n.x,n.y,n.r,0,Math.PI*2);
    ctx.fillStyle="rgba(255,255,255,0.7)";
    ctx.fill();
  });
  for(let i=0;i<nodes.length;i++){
    for(let j=i+1;j<nodes.length;j++){
      const dx = nodes[i].x - nodes[j].x;
      const dy = nodes[i].y - nodes[j].y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist<maxDist){
        ctx.beginPath();
        ctx.moveTo(nodes[i].x,nodes[i].y);
        ctx.lineTo(nodes[j].x,nodes[j].y);
        ctx.strokeStyle=`rgba(255,255,255,${1-dist/maxDist})`;
        ctx.lineWidth=1;
        ctx.stroke();
      }
    }
  }
  requestAnimationFrame(animate);
}
animate();
window.addEventListener('resize',()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>
