<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard â€“ HAFEDPOLY</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
/* Base */
*{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;}
body{margin:0;background:#f0f6ff;color:#333;overflow-x:hidden;}
a{text-decoration:none;}
button{outline:none;}

/* Header */
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.1);
  position:sticky;top:0;z-index:1000;
}
header h1{margin:0;font-size:20px;color:#007bff;}
.hamburger{width:28px;height:20px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;}
.hamburger span{display:block;height:3px;background:#007bff;border-radius:2px;transition:.3s;}
.hamburger.active span:nth-child(1){transform:translateY(8.5px) rotate(45deg);}
.hamburger.active span:nth-child(2){opacity:0;}
.hamburger.active span:nth-child(3){transform:translateY(-8.5px) rotate(-45deg);}

/* Sidebar */
nav{
  position:fixed;top:0;right:-250px;width:220px;height:100%;
  background:#fff;box-shadow:-2px 0 10px rgba(0,0,0,.15);
  padding:20px;transition:.3s;z-index:999;
}
nav.active{right:0;}
nav a{display:block;margin:14px 0;color:#007bff;font-weight:600;}
nav a:hover{text-decoration:underline;}

/* Container */
.container{padding:20px;max-width:1200px;margin:0 auto;}

/* Boxes */
.box{background:#fff;border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 6px 20px rgba(0,0,0,.1);}
h2{margin:0 0 12px;font-size:18px;color:#007bff;}

/* Table */
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;margin-top:12px;min-width:700px;}
th,td{border:1px solid #ccc;padding:8px;text-align:left;font-size:14px;}
th{background:#007bff;color:#fff;}
tr:nth-child(even){background:#f9f9f9;}

/* Action buttons */
button.action{
  padding:6px 10px;margin:2px;border:none;border-radius:6px;
  cursor:pointer;color:#fff;font-size:13px;
  display:inline-flex;align-items:center;gap:4px;
}
.impersonate{background:#28a745;}
.showpw{background:#17a2b8;}
.edit{background:#ffc107;color:#000;}
.delete{background:#dc3545;}
button.action:hover{opacity:.85;}

/* Modal */
.modal{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  backdrop-filter: blur(6px);background: rgba(0,0,0,0.5);
  z-index:3000;justify-content:center;align-items:center;
}
.modal-content{
  background:#fff;border-radius:12px;padding:24px;width:360px;
  max-width:90%;box-shadow:0 10px 30px rgba(0,0,0,0.25);
  transform: translateY(-50px);opacity:0;animation:slideIn 0.3s forwards;
}
.modal-content h2{margin-top:0;color:#007bff;}
.modal-content label{display:block;margin-top:12px;font-weight:600;font-size:0.9rem;}
.modal-content input{width:100%;padding:8px 12px;margin-top:4px;border-radius:6px;border:1px solid #ccc;font-size:0.9rem;}
.modal-actions{margin-top:16px;text-align:right;}
.modal-actions .btn{padding:6px 14px;border-radius:6px;border:none;cursor:pointer;font-weight:600;margin-left:8px;transition:0.2s;}
.modal-actions .btn.save{background:#28a745;color:#fff;}
.modal-actions .btn.cancel{background:#dc3545;color:#fff;}
.modal-actions .btn:hover{opacity:.85;}
@keyframes slideIn{to{transform:translateY(0);opacity:1;}}

/* Particle canvas */
#particleCanvas{
  position: fixed;top:0;left:0;width:100%;height:100%;
  z-index:-1;background: linear-gradient(135deg,#e0f7ff,#eef2f7);
}

/* Responsive */
@media(max-width:768px){
  header h1{font-size:18px;}
  table,th,td{font-size:12px;}
}
</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<header>
  <h1>Admin Dashboard</h1>
  <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</header>

<nav id="nav">
  <a href="#dashboard">Dashboard</a>
  <a href="#students">Students</a>
  <a href="admin-complaint.html">Complaints</a>
  <a href="admin-suggestion.html">Suggestions</a>
  <a href="admin-verify.html">VerifyIDs</a>
  <a href="admin-announcement.html">Announcements</a>
  <a href="admin-report.html">Admin Report</a>
  <a href="#" id="logoutLink">Logout</a>
</nav>

<div class="container">
  <!-- Dashboard -->
  <div class="box" id="dashboard">
    <h2>Dashboard Overview</h2>
    <p>Total Students: <span id="totalStudents">0</span></p>
    <p>Total Complaints: <span id="totalComplaints">0</span></p>
    <p>Total Suggestions: <span id="totalSuggestions">0</span></p>
  </div>

  <!-- Students Management -->
  <div class="box" id="students">
    <h2>Students Management</h2>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>ID</th><th>Name</th><th>Reg No</th><th>Email</th><th>Level</th><th>Department</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentsBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h2>Edit Student</h2>
    <form id="editForm">
      <label>Name:</label>
      <input type="text" id="editName" required>
      <label>Email:</label>
      <input type="email" id="editEmail" required>
      <label>Level:</label>
      <input type="text" id="editLevel">
      <label>Department:</label>
      <input type="text" id="editDepartment">
      <div class="modal-actions">
        <button type="button" id="cancelEdit" class="btn cancel">Cancel</button>
        <button type="submit" class="btn save">Save</button>
      </div>
    </form>
  </div>
</div>

<script>
// Sidebar toggle
const $=id=>document.getElementById(id);
const hamburger=$("hamburger");
const nav=$("nav");
hamburger.onclick=()=>{hamburger.classList.toggle("active");nav.classList.toggle("active");};

// Dashboard data
function loadOverview(){
  const students=JSON.parse(localStorage.getItem("users")||"[]").filter(u=>u.role==="student");
  $("totalStudents").textContent=students.length;
  const tbody=$("studentsBody");
  tbody.innerHTML="";
  students.forEach(s=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${s.uniqueId||"-"}</td>
      <td>${s.name}</td>
      <td>${s.regno}</td>
      <td>${s.email}</td>
      <td>${s.level||"-"}</td>
      <td>${s.department||"-"}</td>
      <td>
        <button class="action impersonate" onclick='impersonate("${s.regno}")'><i class="fa-solid fa-user-check"></i> Impersonate</button>
        <button class="action showpw" onclick='revealPassword("${s.regno}")'><i class="fa-solid fa-eye"></i> Show PW</button>
        <button class="action edit" onclick='editStudent("${s.regno}")'><i class="fa-solid fa-pen"></i> Edit</button>
        <button class="action delete" onclick='deleteStudent("${s.regno}")'><i class="fa-solid fa-trash"></i> Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

// Actions
function impersonate(regno){
  const users=JSON.parse(localStorage.getItem("users")||"[]");
  const student=users.find(u=>u.regno===regno);
  if(!student) return alert("Student not found.");
  localStorage.removeItem("activeAdmin");
  localStorage.setItem("activeStudent",JSON.stringify(student));
  alert(`Now impersonating ${student.name}`);
  window.location.href="student-dashboard.html";
}

function revealPassword(regno){
  const users=JSON.parse(localStorage.getItem("users")||"[]");
  const student=users.find(u=>u.regno===regno);
  if(!student) return alert("Student not found.");
  alert(`Password for ${student.name}: ${student.password}`);
}

// Edit modal
let currentEditRegno = null;
function editStudent(regno){
  const users = JSON.parse(localStorage.getItem("users")||"[]");
  const student = users.find(u => u.regno===regno);
  if(!student) return alert("Student not found.");
  currentEditRegno = regno;
  $("editName").value = student.name;
  $("editEmail").value = student.email;
  $("editLevel").value = student.level || "";
  $("editDepartment").value = student.department || "";
  $("editModal").style.display = "flex";
}

$("cancelEdit").onclick = () => {
  $("editModal").style.display = "none";
  currentEditRegno = null;
};

$("editForm").onsubmit = (e) => {
  e.preventDefault();
  const users = JSON.parse(localStorage.getItem("users")||"[]");
  const student = users.find(u => u.regno===currentEditRegno);
  if(!student) return;
  student.name = $("editName").value.trim();
  student.email = $("editEmail").value.trim();
  student.level = $("editLevel").value.trim();
  student.department = $("editDepartment").value.trim();
  localStorage.setItem("users", JSON.stringify(users));
  $("editModal").style.display = "none";
  currentEditRegno = null;
  loadOverview();
  alert("Student updated successfully!");
};
window.onclick = (e) => {
  if(e.target === $("editModal")) $("editModal").style.display = "none";
};

// Delete
function deleteStudent(regno){
  if(!confirm("Delete this student?")) return;
  let users=JSON.parse(localStorage.getItem("users")||"[]");
  users=users.filter(u=>u.regno!==regno);
  localStorage.setItem("users",JSON.stringify(users));
  loadOverview();
  alert("Student deleted.");
}

// Logout
$("logoutLink").addEventListener("click",e=>{
  e.preventDefault();
  localStorage.removeItem("activeAdmin");
  window.location.href="login.html";
});

// Totals
function loadTotals(){
  const complaints = JSON.parse(localStorage.getItem("complaints") || "[]");
  $("totalComplaints").textContent = complaints.length;
  const suggestions = JSON.parse(localStorage.getItem("suggestions") || "[]");
  $("totalSuggestions").textContent = suggestions.length;
}

loadOverview();
loadTotals();
</script>

<!-- Particle background -->
<script>
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];
const particleCount = 300;
for(let i=0;i<particleCount;i++){
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*4+1,
    dx:(Math.random()-0.5)*2.5,
    dy:(Math.random()-0.5)*2.5
  });
}

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<0||p.x>canvas.width)p.dx*=-1;
    if(p.y<0||p.y>canvas.height)p.dy*=-1;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle="rgba(0,123,255,0.8)";
    ctx.fill();
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();
window.addEventListener('resize',()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
});
</script>

</body>
</html>